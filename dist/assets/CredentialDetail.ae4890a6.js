import{c as d,o as a,a as o,r as se,u as e,b as te,f as O,_ as K,d as U,t as ae,e as M,g as F,h as z,i as s,j as m,k as j,w as ne,l as H,n as oe,m as k,p as re,T as ie,S as ce,L as le,q as de,s as W,v as Y,x as G,y as ue,z as pe,F as S,A as T,B as L,C as fe,P as _e,D}from"./index.91ebbbd4.js";const ve={__name:"IAmVerifiableButton",props:{requisites:{type:Array,required:!0},isVerifying:{type:Boolean,default:!1}},emits:["verification:started","verification:ended","verification:succeded","verification:failed","update:isVerifying"],setup(n,{emit:r}){const u=n,f=d({get:()=>u.isVerifying,set:c=>r("update:isVerifying",c)}),i=async()=>{r("verification:started"),f.value=!0;const c=await te(u.requisites??[]);return f.value=!1,r(c?"verification:succeded":"verification:failed"),r("verification:ended"),c};return(c,x)=>(a(),o("button",{onClick:i,class:"i-am-verifiable-button"},[se(c.$slots,"default",{isVerifying:e(f)})]))}},he=n=>{const r=O(n);return Number.parseFloat(r.replace(`${n.currency.symbol} `,""))};const ye=n=>(W("data-v-02b65b7f"),n=n(),Y(),n),me={class:"py-4 px-2"},be=ye(()=>s("h6",{class:"text-gray-500"},"Precio de este dispensador",-1)),xe={class:"text-primary-700 font-bold text-3xl my-2"},ge={class:"mb-4"},we={__name:"CandyMachineBuyRow",props:["candyMachine","requisites","nft","disabledExternal"],emits:["purchase:started","purchase:succeded","purchase:ended"],setup(n,{emit:r}){const u=n,f=U(),{candyMachine:i,nft:c,disabledExternal:x}=ae(u),t=M(!1),y=M(!1),$=d(()=>O(i.value.price)),{connected:R}=F(),{nftsOfUser:g,isFetchingNftsOfUser:C}=z(),B=d(()=>g.value?g.value.map(_=>_.collection.address.toBase58()):[]),V=d(()=>B.value.includes(c.value.address.toBase58())),w=d(()=>C.value||t.value||y.value||!R.value||V.value||x.value),q=()=>{k({type:"error",title:"No se poseen los requisitos necesarios para poder comprar esta credencial."})},l=async()=>{const{metaplex:_,connectionConfirm:h}=G(),{publicKey:v}=re();y.value=!0;const{wallet:A,sendTransaction:J,publicKey:E}=F();r("purchase:started");try{const N=A.value;let P=new ie().add(ce.transfer({fromPubkey:E.value,toPubkey:v,lamports:le*he(i.value.price)}));const{context:{slot:I},value:{blockhash:Q,lastValidBlockHeight:X}}=await h.getLatestBlockhashAndContext(),Z=await J(P,h,{minContextSlot:I});if((await h.confirmTransaction({blockhash:Q,lastValidBlockHeight:X,signature:Z})).value.err)k({type:"error",title:"Ocurrio un error al generar la credencial si los problemas persisten refresca la p\xE1gina."});else{const ee=await _axios.post("mint/nft",{candyMachine:i.value.address,wallet:E.value});g.value.push(de(ee.data.nft)),r("purchase:succeded",i),k({type:"success",title:"Se ha comprado con \xE9xito la credencial."})}}catch(N){if(N.name&&N.name.toLowerCase()=="metaplexerror"&&N.cause.message.toLowerCase().includes("attempt to debit an account but found no record of a prior credit"))k({type:"error",title:"No se tiene el suficiente cr\xE9dito para comprar la credencial."});else{k({type:"error",title:"Ocurrio un error al generar la credencial si los problemas persisten refresca la p\xE1gina."});const P=await _.value.candyMachines().refresh(i.value).run(),I=P.address.toBase58();f.state.credentials.candyMachinesMapped[I]=P}}y.value=!1,r("purchase:ended")},p=d(()=>V.value?"Ya se tiene la credencial":t.value?"Verificando":y.value?"Procesando":"Comprar credencial");return(_,h)=>(a(),o("div",me,[be,s("h2",xe,m(e($)),1),s("div",ge,"En este dispensador se poseen "+m(e(i).itemsRemaining.toString())+" disponibles",1),j(e(ve),{class:oe(["py-3 px-8 rounded-lg text-white",{"purchase-button":!e(w),"purchase-button-disabled":e(w)}]),disabled:e(w),isVerifying:t.value,"onUpdate:isVerifying":h[0]||(h[0]=v=>t.value=v),"onVerification:failed":q,"onVerification:succeded":l,requisites:n.requisites??[]},{default:ne(()=>[H(m(e(p)),1)]),_:1},8,["class","disabled","isVerifying","requisites"])]))}},ke=K(we,[["__scopeId","data-v-02b65b7f"]]);const b=n=>(W("data-v-e6fb3d7a"),n=n(),Y(),n),Me={class:"container mx-auto flex flex-wrap py-8"},Ce={key:0,class:"w-full"},Be=b(()=>s("div",{class:"text-xl font-semibold text-center mt-2"},"Cargando Credencial",-1)),Ve={key:1,class:"mx-auto"},qe=b(()=>s("div",{class:"text-xl font-semibold text-center mt-2"},"Hubo un error al cargar la credencial por favor prueba de nuevo",-1)),Ne={class:"flex flex-wrap w-full md:w-2/5 lg:w-2/6 gap-y-8"},Pe=["src"],Se={key:1,class:"credential-cover"},$e={class:"w-full rounded-lg border border-slate-300 overflow-clip"},Re=b(()=>s("div",{class:"text-lg p-3 text-center font-bold border-b border-slate-300"},"Descripci\xF3n",-1)),Ae={class:"text-base p-3 w-full bg-slate-300/20"},Ie=b(()=>s("div",{class:"text-lg p-3 text-center font-bold border-y border-slate-300"},"Requisitos",-1)),je={class:"text-base w-full bg-slate-300/20 p-3"},Ee=H("Cargando requisitos"),Fe={key:1,class:"list-disc list-outside px-3"},Te={key:2},Le={class:"px-8 w-full md:w-3/5 lg:w-4/6"},De={class:"flex flex-col gap-y-4"},Oe={class:"text-3xl font-bold"},Ke=b(()=>s("h1",{class:"text-base font-light"},"hecho por RENAP",-1)),Ue={class:"w-full rounded-lg border border-slate-300 overflow-clip"},ze=b(()=>s("h1",{class:"text-xl p-3 text-center font-bold border-b border-slate-300"},"Configuraci\xF3n",-1)),He={class:"text-base p-3 w-full bg-slate-300/20"},We={class:"w-full rounded-lg border border-slate-300 overflow-clip"},Ye=b(()=>s("div",{class:"text-lg p-3 text-center font-bold border-b border-slate-300"},"Detalles de compra",-1)),Ge={class:"text-base p-3 w-full bg-slate-300/20"},Je={key:1},Qe={key:2,class:"flex flex-wrap"},Xe={__name:"CredentialDetail",setup(n){const r=fe(),u=U(),f=r.params.address,i=M(!1),c=M(!1),x=M(!1),t=d(()=>u.getters.nftsMapped[f]),{requisites:y,isFetchingRequisited:$}=ue(t);z();const R=d(()=>{if(t.value.json&&t.value.json.expiration){const l=t.value.json.expiration;return`La credencial expira ${l.years} a\xF1os, ${l.months} meses y ${l.days} d\xEDas despues de su emisi\xF3n`}return"Esta credencial no expira"}),g=d(()=>t.value&&t.value.json?t.value.json.image:null),C=d(()=>u.getters.candyMachinesMintMapped),B=d(()=>{if(t.value){const l=t.value.mint.address.toBase58();if(l in C.value)return C.value[l].filter(p=>parseInt(p.itemsRemaining.toString())>0)}return[]}),V=async l=>{l.collectionMintAddress.toBase58();const{metaplex:p}=G(),_=p.value.candyMachines().refresh(l).run();u.dispatch("updateCandyMachine",_)},w=async()=>{i.value=!0,await u.dispatch("getNftFromMintAddress",new _e(f)),i.value=!1},q=async()=>{x.value=!0,await u.dispatch("getCandyMachines",f),x.value=!1};return pe(async()=>{t.value||await w(),q()}),(l,p)=>{const _=D("lottie-player"),h=D("v-spinner");return a(),o("div",Me,[i.value?(a(),o("div",Ce,[j(_,{class:"self-center mt-4 mx-auto",src:"https://assets9.lottiefiles.com/packages/lf20_usmfx6bp.json",background:"transparent",speed:"1",style:{width:"300px",height:"300px"},loop:"",autoplay:""}),Be])):e(t)?(a(),o(S,{key:2},[s("div",Ne,[e(g)?(a(),o("img",{key:0,src:e(g),class:"credential-cover"},null,8,Pe)):(a(),o("div",Se)),s("div",$e,[Re,s("div",Ae,m(e(t).json.description),1),Ie,s("div",je,[e($)?(a(),o(S,{key:0},[Ee],64)):e(y).length?(a(),o("ul",Fe,[(a(!0),o(S,null,T(e(y),v=>(a(),o("li",{key:v.address.toBase58()},m(v.name),1))),128))])):(a(),o("div",Te,"No tiene requisitos"))])])]),s("div",Le,[s("div",De,[s("h1",Oe,m(e(t).name),1),Ke,s("div",Ue,[ze,s("div",He,m(e(R)),1)]),s("div",We,[Ye,s("div",Ge,[x.value?(a(),L(h,{key:0})):e(B).length?(a(),o("div",Qe,[(a(!0),o(S,null,T(e(B),v=>(a(),L(e(ke),{"onPurchase:started":p[0]||(p[0]=A=>c.value=!0),"onPurchase:ended":p[1]||(p[1]=A=>c.value=!1),"onPurchase:succeded":V,disabledExternal:c.value,class:"border-b border-gray-300 last:border-b-0 md:w-full lg:w-1/2 xl:w-1/3",key:v.address.toBase58(),candyMachine:v,nft:e(t),requisites:e(t).json.requisites??[]},null,8,["disabledExternal","candyMachine","nft","requisites"]))),128))])):(a(),o("div",Je,"No hay opci\xF3nes de compra por el momento"))])])])])],64)):(a(),o("div",Ve,[j(_,{class:"self-center mt-4 mx-auto",src:"https://assets4.lottiefiles.com/private_files/lf30_e3pteeho.json",background:"transparent",speed:"1",style:{width:"300px",height:"300px"},loop:"",autoplay:""}),qe]))])}}},ss=K(Xe,[["__scopeId","data-v-e6fb3d7a"]]);export{ss as default};
